<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Tags</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 50px; background: #f4f4f9; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        #resultado { margin-top: 20px; font-weight: bold; padding: 15px; border-radius: 4px; display: none; }
        .antiga { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .atual { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .erro { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Consulta de Tags</h2>
        <input type="text" id="inputTag" placeholder="Digite a TAG antiga ou nova..." py-keyup="verificar_tag">
        <div id="resultado"></div>
    </div>

    <py-config>
        packages = ["pandas"]
        # O fetch garante que o arquivo CSV seja baixado para o sistema de arquivos virtual do PyScript
        [[fetch]]
        files = ["tags.csv"]
    </py-config>

    <script type="py">
        import pandas as pd
        from pyscript import document

        # Carrega os dados do arquivo que foi 'buscado' pelo py-config
        df = pd.read_csv("tags.csv", encoding='latin1', sep=None, engine='python')

        def verificar_tag(event):
            # Processa apenas quando a tecla Enter for pressionada
            if event.key == "Enter":
                tag_digitada = document.getElementById("inputTag").value.strip().upper()
                resultado_div = document.getElementById("resultado")

                if not tag_digitada:
                    resultado_div.style.display = "none"
                    return

                # Lógica de busca usando Pandas
                filtro_antiga = df[df['antiga'].astype(str).str.upper() == tag_digitada]
                filtro_nova = df[df['nova'].astype(str).str.upper() == tag_digitada]

                resultado_div.style.display = "block"

                if not filtro_antiga.empty:
                    tag_nova = filtro_antiga.iloc[0]['nova']
                    resultado_div.className = "antiga"
                    resultado_div.innerHTML = f"Tag Antiga Detectada!<br>Nova Tag: {tag_nova}"

                elif not filtro_nova.empty:
                    resultado_div.className = "atual"
                    resultado_div.innerHTML = "Esta tag já é a atual."

                else:
                    resultado_div.className = "erro"
                    resultado_div.innerHTML = "Tag não encontrada na base de dados."

                # Limpa o campo para a próxima consulta
                document.getElementById("inputTag").value = ""
    </script>
</body>
</html>
